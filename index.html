<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Noughts and Crosses</title>
  <link href="dependencies/bootstrap.min.css" rel="stylesheet">
  <link href="css/pagewide.css" rel="stylesheet">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
  <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Home</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li><a href="#">About</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Content ==========================================================================  -->
  <style>
   #theboard { width: 100% }
   #theboard td { border: 1px darkgray solid; height: 4em;}
  </style>
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1>Noughts and Crosses</h1>
        <h3>Who's playing?</h3>
        <p id="aiChoiceBtns">
          <label for="human"><input name="opponentChoice" type="radio" id="human" checked/> Human</label>
          <label for="ai"><input name="opponentChoice" type="radio" id="ai"/> AI</label>
        </p>
        <div style="display: none;" id="aiPieceChoiceDiv">
          <h3>AI plays what?</h3>
          <p>
            <label for="ainoughts"><input name="aiPieceChoice" type="radio" id="ainoughts"/> Noughts</label>
            <label for="aicrosses"><input name="aiPieceChoice" type="radio" id="aicrosses"/> Crosses</label>
          </p>
        </div>
        <h3>Who goes first?</h3>
        <p id="pieceChoiceBtns">
          <label for="noughts"><input name="pieceChoice" type="radio" id="noughts" checked/> Noughts</label>
          <label for="crosses"><input name="pieceChoice" type="radio" id="crosses"/> Crosses</label>
        </p>
        <h3>Board</h3>
        <table>
         <tbody id="theboard">
          <tr class="row"><td id="d11" class="col-xs-4">&nbsp;</td><td id="d12" class="col-xs-4">&nbsp;</td><td id="d13" class="col-xs-4">&nbsp;</td></tr>
          <tr class="row"><td id="d21" class="col-xs-4">&nbsp;</td><td id="d22" class="col-xs-4">&nbsp;</td><td id="d23" class="col-xs-4">&nbsp;</td></tr>
          <tr class="row"><td id="d31" class="col-xs-4">&nbsp;</td><td id="d32" class="col-xs-4">&nbsp;</td><td id="d33" class="col-xs-4">&nbsp;</td></tr>
         </tbody>
        </table>
        <h3>Result</h3>
        <p id="status">Waiting to start game ...</p>
        <p>Who's move: <span id="whosMove"></span></p>
        <p id="winner"></p>
      </div>
    </div>
  </div>
  <!-- /.container -->

  <!-- Dependencies ====================================================================================== -->
  <script src="dependencies/jquery.js"></script>
  <script src="dependencies/bootstrap.min.js"></script>

  <!-- Domain ====================================================================================== -->
  <script src="js/noughtsandcrosses.js"></script>
  <script src="js/noughtsandcrossesai.js"></script>
  <script>
    var gameModel= new NoughtsAndCrossesBoardModel("O");
    var currentAI= new NoughtsAndCrossesAI();
  </script>

  <!-- Inputs and Outputs ====================================================================================== -->
  <script id="inputs-and-outputs">
   var boardSquares = {
     "1" : { "1": $("#d11"), "2" : $("#d12"), "3" : $("#d13") },
     "2" : { "1": $("#d21"), "2" : $("#d22"), "3" : $("#d23") },
     "3" : { "1": $("#d31"), "2" : $("#d32"), "3" : $("#d33") }
   };
   var inputs = {
     board : $("#theboard"),
     chooseNoughtsStarts: $("#noughts"),
     chooseCrossesStarts: $("#crosses"),
     chooseHuman: $("#human"),
     chooseAI: $("#ai"),
     chooseAIPieces: $("#aiPieceChoiceDiv"),
     chooseAINoughts:$("#ainoughts"),
     chooseAICrosses:$("#aicrosses"),
     getChosenAIPieces: function(){
       return inputs.chooseAICrosses.is(":checked") ? "X" :
              inputs.chooseAINoughts.is(":checked") ? "O" : null;},

     getWhoStarts: function(){
       return inputs.chooseCrossesStarts.is(":checked") ? "X" :
              inputs.chooseNoughtsStarts.is(":checked") ? "O" : null;
     }
   };
   var outputs = {
     boardSquares : boardSquares,
     status : $("#status"),
     winner : $("#winner"),
     whosMove : $("#whosMove")
   };
  </script>

  <!-- Updaters====================================================================================== -->
  <script id="updaters">

    var strings={
      nowinnertext: " ",
      winnertext: "The winner is "
    };

    function synchroniseOutputCommentary(){
      outputs.status.text(gameModel.status());
      function formatWinnerText(){
        var winner= gameModel.winner();
        return !!winner ? strings.winnertext + winner : strings.nowinnertext;
      }
      outputs.winner.text( formatWinnerText());
      outputs.whosMove.text(gameModel.whosMove());
    }

    function clearGameBoardAndView(goingFirst){
      gameModel= new NoughtsAndCrossesBoardModel(goingFirst);
      for(var i=1;i<=3;i++)
      for(var j=1;j<=3;j++){
        outputs.boardSquares[i][j].text( gameModel.state[i][j] )
      }
      synchroniseOutputCommentary();
    }

    function playMoveAndUpdateOutputBoard(x, y) {
      gameModel.play(x, y);
      outputs.boardSquares[x][y].text(gameModel.state[x][y]);
      synchroniseOutputCommentary();
      if(inputs.chooseAI.is(":checked") && gameModel.whosMove()==inputs.getChosenAIPieces()){
        currentAI.promptToMove(); }
    }


    function startNewGame(goingFirst){
      clearGameBoardAndView(goingFirst);
      if(inputs.chooseAI.is(":checked")){
        currentAI.startPlaying( inputs.getChosenAIPieces(), goingFirst, gameModel, playMoveAndUpdateOutputBoard );
      }
    }

    inputs.chooseHuman.add(inputs.chooseAI)
        .click(function(){
                inputs.chooseCrossesStarts
                    .add(inputs.chooseNoughtsStarts)
                    .prop("checked", false);
              });

    inputs.chooseHuman.click(function(){ inputs.chooseAIPieces.hide();});
    inputs.chooseAI.click(function(){ inputs.chooseAIPieces.show(); });

    inputs.chooseCrossesStarts.click(function(){ startNewGame("X"); });
    inputs.chooseNoughtsStarts.click(function(){ startNewGame("O"); });

    inputs.board.click(function(evt){
      if( evt.target.tagName != 'TD'){return;}
      //
      var id= evt.target.id;
      var x= id.substr(1,1);
      var y= id.substr(2,1);
      playMoveAndUpdateOutputBoard(x, y);
    })

    ;(function startHumanGameOnPageLoad(){ startNewGame("O"); })();

  </script>


  <!-- Tests ====================================================================================== -->
  <div id="qunit" style="display:none"></div>  <div id="qunit-fixture" style="display:none"></div>
  <script>
    if(window.location.search.match("debug|test")){
      $('head').append('<link rel="stylesheet" href="dependencies/qunit-1.18.0.css" />');
      $("#qunit").add("#qunit-fixture").show();
      document.writeln(
          '' +
          '<script src="dependencies/qunit-1.18.0.js"><' + '/script>' +
          '<script src="js/uitests.js"><' + '/script>' +
          '<script src="js/noughtsandcrossestests.js"><' + '/script>');
    }
  </script>
</body>
</html>
